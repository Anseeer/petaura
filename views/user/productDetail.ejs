<%- include("../partials/user/header.ejs") %>
<div aria-label="breadcrumb">
    <ol class="breadcrumb">
      <% breadcrumbs.forEach((crumb, index) => { %>
        <% if (index === breadcrumbs.length - 1) { %>
          <!-- Last breadcrumb -->
          <li class="breadcrumb-item active" aria-current="page"><%= crumb.text %></li>
        <% } else { %>
          <!-- Other breadcrumbs -->
          <li class="breadcrumb-item">
            <a href="<%= crumb.url %>"><%= crumb.text %></a>
          </li>
        <% } %>
      <% }); %>
    </ol>
  </div>
  
  
<div class="product-detail-page">
    <div class="product-container">
        <div class="product-image">
            <div class="detail-gallery">
                <!-- Main Product Image Slider -->
                <div class="product-image-slider">
                    <figure class="border-radius-10">
                        <img src="<%=Product.Image[0]%>" 
                             style="width: 450px; height: 300px;" 
                             alt="product image" 
                             id="main-image" 
                             class="zoomable">
                    </figure>
                </div>

                <!-- Thumbnails -->
                <div class="slider-nav-thumbnails">
                    <div>
                        <img src="<%=Product.Image[0]%>" 
                             style="width: 50px; height: 50px;" 
                             alt="product image" 
                             class="thumbnail" 
                             data-image="<%=Product.Image[0]%>">
                    </div>
                    <div>
                        <img src="<%=Product.Image[1]%>" 
                             style="width: 50px; height: 50px;" 
                             alt="product image" 
                             class="thumbnail" 
                             data-image="<%=Product.Image[1]%>">
                    </div>
                    <div>
                        <img src="<%=Product.Image[2]%>" 
                             style="width: 50px; height: 50px;" 
                             alt="product image" 
                             class="thumbnail" 
                             data-image="<%=Product.Image[2]%>">
                    </div>
                </div>
            </div>
        </div>

        <div class="product-info">
            <h2 class="product-name"><strong><%=Product.name%></strong></h2>
            <!-- <p>A premium cat food, specially formulated to cater to the nutritional needs of adult cats.</p> -->
            <p>Brand</p>
            <div class="rating">
                <span class="star">&#9733;&#9733;&#9733;&#9733;&#9734;</span>
                <span class="rating-text">(4.7/5)</span>
            </div>
            <% if(Product.Offer > 0 ){ %>
              <p class="price">
                <span class="discounted-price">₹<%=Product.finalPrice%></span>
                <strike class="original-price">₹<%=Product.salePrice%></strike>
            </p>
              <%}else{%>
                <p class="price">
                  <span class="discounted-price">₹<%=Product.finalPrice%></span>
                  <strike class="original-price">₹<%=Product.regularPrice%></strike>
              </p>
                <%}%>
            
            <p>Offer: <%=Offer%>%</p>
            <p>Status: <%=Product.Status%> Stock : <%=Quantity%></p>
            <p>Delivery in 1-3 Days</p>
        
        
            <div class="call-to-action">
                <!-- Wishlist Button with Heart Icon -->
                <button class="cart-btn" id="wishlist-btn" onclick=" event.stopPropagation();  return  addToWishlist(event,'<%= Product._id %>')"><i class="fas fa-heart"></i></button>
                <% if(Product.Status == "Out of Stock" || Product.quantity <= 0 ){ %>
                    <% Product.Status = "Out of Stock" %>
                <h4 style="padding-top: 15px;color: red;font-weight: 600;"><%=Product.Status%></h4>
                <%}else{%>
                    <a href="/user/add-to-cart?productId=<%= Product._id %> "><button class="cart-btn"><i class="fas fa-shopping-cart"></i></button></a>

                <!-- Buy Now Button with text only -->
                <button class="buy-now">Buy Now</button>
                    <%}%>
            </div>
        </div>
    </div>

    <!-- Tab Section -->
    <div class="toggle-section">
        <button id="description-tab" class="toggle-btn active">Description</button>
        <button id="review-tab" class="toggle-btn">Review</button>
    </div>

    <!-- Content Section -->
    <div id="description-content" class="content active">
        <h3>Description</h3>
        <p><%=Product.description%></p>
    </div>
    

    <div id="review-content" class="content">
        <h3>Review</h3>
        <p>⭐⭐⭐⭐☆</p>
        <p>"My cat loves this food! It’s her favorite meal every day. Highly recommended!" - Jane Doe</p>
        <p>"Good product but slightly expensive. Still, my cat seems happy." - John Smith</p>
    </div>
</div>

<!-- Product Listing Section -->
<div class="container-fluid">
    <%if(Related.length > 0){%>
    <h1 class="Related">Related Products :</h1>
    <%}%>
    <div class="row ">
        <% for(let i=0 ; i < Related.length ; i++){ %>
            <div class="col-md-3 py-5 mb--decoration-none">
                <div class="Ccard posi4">
                  
                    <a href="/user/ProuctDetails?product=<%= Related[i]._id %>" class="texttion-relative">
                        <!-- Wishlist button -->
                        <button class="wishlist-btn btn btn-light p-2 rounded-circle position-absolute top-0 end-0 m-2">
                            <i class="fa fa-heart"></i>
                        </button>

                        <!-- Product image -->
                        <img src="<%=Related[i].Image[0]%>" alt="" class="Ccard-img-top">

                        <!-- Card body -->
                        <div class="Ccard-body">
                            <h5 class="Ccard-title">Name:<%=Related[i].name%></h5>
                            <p>Brand</p>
                            <p class="Ccard-text">Price:₹<%=Related[i].salePrice%><strike>₹<%=Related[i].regularPrice%></strike></p>
                            <button class="btn btn-warning">Add to Cart</button>
                        </div>
                    </a>
                </div>
            </div>
        <% } %>
    </div>
</div>

<script>
    // Thumbnail functionality
    const thumbnails = document.querySelectorAll('.thumbnail');
    const mainImage = document.getElementById('main-image');

    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            const newImageSrc = this.getAttribute('data-image');
            mainImage.src = newImageSrc;
        });
    });

    // Zoom functionality
    let zoomLevel = 1;
    mainImage.addEventListener('click', function() {
        zoomLevel = zoomLevel === 1 ? 2 : 1; // Toggle zoom between 1x and 2x
        this.style.transform = `scale(${zoomLevel})`; // Correct use of template literals
    });

    mainImage.addEventListener('wheel', function(event) {
        event.preventDefault();
        if (zoomLevel > 1) {
            zoomLevel += event.deltaY * -0.01;
            zoomLevel = Math.min(Math.max(zoomLevel, 1), 5); // Restrict zoom between 1x and 5x
            this.style.transform = `scale(${zoomLevel})`; // Correct use of template literals
        }
    });

    // Tab toggle functionality
    const descriptionTab = document.getElementById('description-tab');
    const reviewTab = document.getElementById('review-tab');
    const descriptionContent = document.getElementById('description-content');
    const reviewContent = document.getElementById('review-content');

    descriptionTab.addEventListener('click', () => {
        descriptionTab.classList.add('active');
        reviewTab.classList.remove('active');
        descriptionContent.classList.add('active');
        reviewContent.classList.remove('active');
    });

    reviewTab.addEventListener('click', () => {
        reviewTab.classList.add('active');
        descriptionTab.classList.remove('active');
        reviewContent.classList.add('active');
        descriptionContent.classList.remove('active');
    });

    
  function addToWishlist(e, id) {
  e.preventDefault();

  const button = document.getElementById('wishlist-btn');


  if (button.style.color === 'white') {
    button.style.color = 'red';
    button.style.backgroundColor = 'white';
    fetch("/user/delete-from-whishlist",{
                    method:"POST",
                    headers:{
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({id})
                })
                .then((response)=> response.json())
                .then((response)=>{
                  if(response.success){
                    console.log("removed");
                  }else{
                    console.log("Faild To Remove")
                  }
                })
                .catch(()=>{
                  console.log("Error");
                })
    
  } else {
    button.style.color = 'white';
    button.style.backgroundColor = 'red';
    console.log("Styart fetch")
    fetch("/user/add-to-whishlist",{
      method:"POST",
      headers:{
        'Content-Type':'application/json'
      },
      body:JSON.stringify({id})
    })
    .then((response)=> response.json())
    .then((response)=>{
      if(response.success){
        console.log("Sucessfully Added Whislist",response.message);
      }else{
        console.log("Faild To Add Whislist");
      }
    })
    .catch((err)=> console.log(err.message))

  }

  console.log('Toggled wishlist button for product ID:', id);
}

</script>

<%- include("../partials/user/footer.ejs") %>
