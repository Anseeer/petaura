<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petaura - Address</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
               body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #f7f7f7;
        }

        /* Header Styling */
        .header {
            background: linear-gradient(90deg, #ffa500, #ff7f50);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            width: 100%;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .header .logo {
            font-size: 26px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }

        /* Sidebar Styling */
        .sidebar {
            position: fixed;
            top: 70px; /* Start below the header */
            left: 0;
            width: 250px;
            height: calc(100% - 70px);
            background: linear-gradient(180deg, #ffa500, #ffd27f);
            color: white;
            padding-top: 10px;
            box-shadow: 3px 0 8px rgba(0, 0, 0, 0.2);
        }

        .sidebar a {
            display: flex;
            align-items: center;
            color: black;
            padding: 12px 20px;
            margin: 5px 15px;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .sidebar a:hover,
        .sidebar a.active {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .sidebar i {
            margin-right: 10px;
            font-size: 18px;
        }

        /* Content Area */
        .content {
            margin-left: 270px;
            padding: 20px;
            padding-top: 100px; /* Push content down to not overlap with the fixed header */
        }


        /* address */
        .address-form {
            background-color: #f9f9f9;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .address-form h5 {
            margin-bottom: 20px;
            color: #333;
        }

        .form-control {
            margin-bottom: 15px;
        }

        .address-table {
            margin-top: 20px;
            border: 1px solid #ddd;
        }

        .address-table th {
            background-color: #ffa500;
            color: white;
        }
        .err-msg{
            color: red;
        }
        svg {
    color: #000000; /* Blue color */
    cursor: pointer; /* Pointer cursor for interactivity */
    transition: color 0.3s;
    width: 30px;
  }

  svg:hover {
    color: #ffffff; /* Darker blue on hover */
  }
    </style>
</head>

<body>

    <div class="header">
        <div class="logo">Petaura</div>
        <div class="d-flex end-0">
            <a href="/user" class="home-link">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                    <path d="M12 3l7 6v12a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V9l7-6zm5 7.586V19h-3v-4H10v4H7v-8.414L12 5.414l5 5.172z" />
                </svg>
                
            </a>
        </div>
            </div>

            <div class="sidebar">
                <a href="/user/profile"><i class="fas fa-user"></i> Account Details</a>
                <a href="/user/orderHistory" ><i class="fas fa-clock"></i> Order History</a>
                <a href="#"><i class="fas fa-wallet"></i> Wallet</a>
                <a href="/user/cart"><i class="fas fa-shopping-cart"></i> Shopping Cart</a>
                <a href="/user/whishlist"><i class="fas fa-heart"></i> Wishlist</a>
                <a href="/user/address"><i class="fas fa-map-marker-alt" class="active"></i> Address</a>
                <a href="/user/referral"><i class="fas fa-user-friends"></i> Referral</a>
                <a href="/user/logOut"><i class="fas fa-sign-out-alt"></i> Log-out</a>
            </div>

    <div class="content ">
        <!-- Address Form -->
        <div class="address-form py-5" >
            <h5>Add Address</h5>
            <form action="" onsubmit="addAddress(event)" novalidate method="POST">
                <div class="row">
                    <div class="col-md-6">
                        <select name="typeOfAddress" id="typeOfAddress" class="form-control" >
                            <option value="" disabled selected>Type of Address</option>
                            <option value="Home">Home</option>
                            <option value="Office">Office</option>
                            <option value="Other">Other</option>
                        </select>
                        <div class="err-msg" id="err1"></div>
                    </div>
                    <div class="col-md-6">
                        <input type="text" name="name" id="name" placeholder="Name" class="form-control" >
                        <div class="err-msg" id="err2"></div>
                    </div>
                    <div class="col-md-6">
                        <input type="text" name="country" id="country" placeholder="country" class="form-control" >
                        <div class="err-msg" id="err3"></div>
                    </div>
                    <div class="col-md-6">
                        <input type="text" name="state" id="state" placeholder="State" class="form-control" >
                        <div class="err-msg" id="err4"></div>
                    </div>
                    <div class="col-md-6">
                        <input type="number" maxlength="6"  name="pincode" id="pincode" placeholder="Pincode" class="form-control" >
                        <div class="err-msg" id="err5"></div>
                    </div>
                    <div class="col-md-6">
                        <input type="text" name="phone" id="phone" placeholder="Phone" class="form-control" >
                        <div class="err-msg" id="err6"></div>
                    </div>
                </div>
                <input type="hidden" value="<%= user %>" id="userId" name="userId">
                <input type="submit" name="" placeholder="" class="form-control" style="background-color:gray; font-size: large; font-weight: bolder; color: white;">
            </form>
        </div>

        <!-- Address Table -->
        <table class="table">
            <% if(address && address.length > 0 ){ %>
            <thead>
                <tr style="border-top: 2px solid black;">
                    <th>#</th>
                    <th>Address</th>
                    <th>Actions</th> 
                </tr>
            </thead>
           
            <tbody>
                <% address.forEach((address,index)=> {%>
                    <tr>
                        <td><%= index + 1 %></td>
                        <td>
                            <strong><%= address.addressType %>:</strong> <%= address.name %>, <%= address.country %>, <%= address.state %>, <%= address.pincode %>, <%= address.phone %>
                        </td>
                        <td>
                            <a href="/user/edit-address?id=<%= address._id %>" class="text-primary"><i class="fas fa-edit"></i></a>
                            <a href="" onclick="deleteAddress(event , '<%= address._id %>') " class="text-danger"><i class="fas fa-trash-alt"></i></a>
                        </td>
                    </tr>
                    
            <%})%>
            </tbody>

        </table>
        <%}%>
        
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
   
   function deleteAddress(event,addressId){
    console.log("addressId:",addressId); 
    event.preventDefault();
    Swal.fire({
            icon: "warning",
            title: "Are you sure?",
            text: "Do you want to delete this product?",
            showCancelButton: true,
            confirmButtonColor: "#d33",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "Yes",
            cancelButtonText: "No",
        })
        .then((res) => {
            if(res.isConfirmed) {
                fetch("/user/delete-address",{
                    method:"POST",
                    headers:{
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({id:addressId})
                }).then((res)=> res.json())
                .then((res)=>{
    if(res.success){
        Swal.fire({
            icon:"success",
            title:"Deleted",
            text:res.message,
            showCancelButton:false,
            showConfirmButton:false,
            timer:1500,
        }).then(()=>{
            location.reload();
        })
    }else{
        Swal.fire({
            icon:"error",
            title:"Faild To Delete",
            text:res.message,
            showCancelButton:false,
            showConfirmButton:false,
            timer:1500,
        });
    }
   })
   .catch(()=>{
    Swal.fire({
            icon:"error",
            title:"Error in deletion",
            text:res.message,
            showCancelButton:false,
            showConfirmButton:false,
            timer:1500,
        });
   });
            } else {
                // Optional: Add a feedback message
                Swal.fire("Cancelled", "Your product is safe!", "info");
            }
        
   });
   

    } 

    function addAddress(event){
        event.preventDefault();
        const typeOfAddress = document.getElementById("typeOfAddress").value;
        const name = document.getElementById("name").value;
        const country = document.getElementById("country").value;
        const state = document.getElementById("state").value;
        const pincode = document.getElementById("pincode").value;
        const phone = document.getElementById("phone").value;
        const userId = document.getElementById("userId").value;
        const err1 = document.getElementById("err1");
        const err2 = document.getElementById("err2");
        const err3 = document.getElementById("err3");
        const err4 = document.getElementById("err4");
        const err5 = document.getElementById("err5");
        const err6 = document.getElementById("err6");


        const typeOfAddressPattern = /^[A-Za-z\s]+$/;
        if(typeOfAddress.trim()===""){
            err1.style.display="block";
            err1.innerHTML="Please Enter The TypeOfAddress";
        }else if (!typeOfAddressPattern.test(typeOfAddress)){
            err1.style.display="block";
            err1.innerHTML="Only allowed alphebets";
        }else{
            err1.style.display="none";
            err1.innerHTML="";
        }

        const namePattern = /^[A-Za-z\s]+$/;
        if(name.trim()===""){
            err2.style.display="block";
            err2.innerHTML="Please Enter Your Name";
        }else if (!namePattern.test(name)){
            err2.style.display="block";
            err2.innerHTML="Only allowed alphebets";
        }else{
            err2.style.display="none";
            err2.innerHTML="";
        }


        const countryPattern = /^[A-Za-z\s]+$/;
        if(country.trim()===""){
            err3.style.display="block";
            err3.innerHTML="Please Enter Your Country";
        }else if (!countryPattern.test(country)){
            err3.style.display="block";
            err3.innerHTML="Only allowed alphebets";
        }else{
            err3.style.display="none";
            err3.innerHTML="";
        }

        const statePattern = /^[A-Za-z\s]+$/;
        if(state.trim()===""){
            err4.style.display="block";
            err4.innerHTML="Please Enter Your State";
        }else if (!statePattern.test(state)){
            err4.style.display="block";
            err4.innerHTML="Only allowed alphebets";
        }else{
            err4.style.display="none";
            err4.innerHTML="";
        }

        const pincodePattern = /^\d{6}$/;
        if(pincode.trim()===""){
            err5.style.display="block";
            err5.innerHTML="Please Enter Your Pincode";
        }else if (!pincodePattern.test(pincode)){
            err5.style.display="block";
            err5.innerHTML="Only allowed Numbers & Must Need Six Number";
        }else{
            err5.style.display="none";
            err5.innerHTML="";
        }

        const phnPattern = /^\d{10}$/;
        if(phone.trim()===""){
            err6.style.display="block";
            err6.innerHTML="Please Enter Your PhoneNumber";
        }else if (!phnPattern.test(phone)){
            err6.style.display="block";
            err6.innerHTML="Invalid Number";
        }else{
            err6.style.display="none";
            err6.innerHTML="";
        }

        if(err1.innerHTML || err2.innerHTML || err3.innerHTML || err4.innerHTML || err5.innerHTML || err6.innerHTML){
            return false;
        }
        

        
    fetch("/user/addAddress",{
    method:"POST",
    headers:{
        'Content-Type':'application/json'
    },
    body:JSON.stringify({typeOfAddress,name,country,state,pincode,phone,userId})
   })
   .then((response)=> response.json())
   .then((response)=>{
    if(response.success){
        Swal.fire({
            icon:"success",
            title:"Add NewAddress",
            text:response.message,
            showCancelButton:false,
            showConfirmButton:false,
            timer:1500,
        }).then(()=>{
            window.location.href="/user/address";
        })
    }else{
        Swal.fire({
            icon:"error",
            title:"Faild To AddAddress",
            text:response.message,
            showCancelButton:false,
            showConfirmButton:false,
            timer:1500,
        })
    }
   })
   .catch((err)=>{
    Swal.fire({
            icon:"error",
            title:"ERROR",
            text:response.message,
            showCancelButton:false,
            showConfirmButton:false,
            timer:1500,
        });
   });

    }


</script>

</html>