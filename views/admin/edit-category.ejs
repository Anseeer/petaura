<%-include("../partials/admin/header.ejs")%>
<head>
    <style>
        .error-msg{
            color: red;
        }
    </style>
</head>
<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="col-md-6">
        <form action="/admin/editCategory" id="editCategory" method="post" class="p-4 shadow rounded bg-white">
            <h2 class="text-center mb-4">Edit Category</h2>
            <div class="mb-4">
                <label for="product_name" class="form-label">Name</label>
                <input type="text" value="<%=category.name%>" placeholder="Type here" class="form-control" name="name" id="name" />
                <div class="error-msg" id="error1"></div>
            </div>
           
            <div class="mb-4">
                <label for="parent" class="form-label">Parent Category</label>
                <select name="parent" class="form-select" id="parent">
                    <option value="">Select Parent Category</option>
                    <% parentCategory.forEach((parent) => { %>
                        <option value="<%= parent._id %>" <%= category.parent == parent._id ? 'selected' : '' %>>
                            <%= parent.name %>
                        </option>
                    <% }); %>
                </select>
                <div class="error-msg" id="error2"></div>
            </div>
            <div class="mb-4">
                <label class="form-label">Offer</label>
                <input type="number" name="offer" value="<%= category.categoryOffer %>">
            </div>
            <div class="mb-4">
                <label class="form-label">Description</label>
                <input type="hidden" name="_id" value="<%= category._id %>">
                <textarea placeholder="Type here" name="description" id="description" class="form-control"><%= category.description %></textarea>
                <div class="error-msg" id="error3"></div>
            </div>
            
            <div class="d-grid">
                <button class="btn btn-primary" type="submit">Edit category</button>
            </div>
        </form>
    </div>
</div>

<script>
// fomr validation of the editcategory 
const name = document.getElementById("name");
const parent = document.getElementById("parent");
const description = document.getElementById("description");
const err1 = document.getElementById("error1");
const err2 = document.getElementById("error2");
const err3 = document.getElementById("error3");
const editCategory = document.getElementById("editCategory"); // Corrected form ID

function nameValidation() {
    const nameVal = name.value;
    const namePattern = /^[a-zA-Z\s]+$/;

    if (nameVal.trim() === "") {
        err1.style.display = "block";
        err1.innerHTML = "Please Enter Category Name";
    } else if (!namePattern.test(nameVal)) {
        err1.style.display = "block";
        err1.innerHTML = "Name Only Allowed Alphabets";
    } else {
        err1.style.display = "none";
        err1.innerHTML = "";
    }
}

function parentValidation() {
    const parentVal = parent.value;
    const parentPattern = /^[a-zA-Z\s]+$/;

    if (parentVal.trim() === "") {
        err2.style.display = "block";
        err2.innerHTML = "Please Enter Parent Category";
    } else {
        err2.style.display = "none";
        err2.innerHTML = "";
    }
}

function descriptionValidation() {
    const desVal = description.value;
    const desPattern = /^[a-zA-Z\s]+$/;

    if (desVal.trim() === "") {
        err3.style.display = "block";
        err3.innerHTML = "Please Enter Description";
    } else if (!desPattern.test(desVal)) {
        err3.style.display = "block";
        err3.innerHTML = "Description Only Allowed Alphabets";
    } else {
        err3.style.display = "none";
        err3.innerHTML = "";
    }
}

document.addEventListener("DOMContentLoaded", function () {
    editCategory.addEventListener("submit", function (e) {
          nameValidation();
           parentValidation();
             descriptionValidation();

        // Prevent form submission if any validation fails
        if (err1.innerHTML || err2.innerHTML || err3.innerHTML) {
            e.preventDefault(); // Prevent form submission
            console.log("Form validation failed.");
        } else {
            console.log("Form validation passed.");
        }
    });
});

</script>

<%- include("../partials/admin/footer.ejs") %>
